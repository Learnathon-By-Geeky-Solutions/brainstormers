@model List<ProjectInvitationViewModel>
@{
	ViewData["Title"] = "Index";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
	<h2>Project Invitations</h2>

	<table class="table table-bordered table-hover">
		<thead class="table-dark">
			<tr>
			<th class="text-center">#</th>
				<th>Project</th>
				<th>Status</th>
				<th>Role</th>
				<th>Invitation Sent</th>
				<th>Accepted</th>
				<th>Declined</th>
				<th class="text-center">Actions</th>
			</tr>
		</thead>
		<tbody>
		@if (Model != null && Model.Any())
		{
			var serial = 1;

			@foreach (var invitation in Model)
			{
				<tr>
					<td class="text-center">@(serial++)</td>
					<td>@invitation.ProjectTitle</td>
					<td>
						<span class="badge 
                                @(invitation.Status == "Pending" ? "bg-warning text-dark" :
                                invitation.Status == "Accepted" ? "bg-success" :
                                invitation.Status == "Declined" ? "bg-danger" : "bg-secondary")">
                                @invitation.Status
						</span>
					</td>
					<td>@invitation.Role</td>
					<td>@invitation.InvitationSentDate.ToString("dd/MM/yyyy hh:mm:ss tt")</td>
					<td>@(invitation.AcceptedDate.HasValue ? invitation.AcceptedDate.Value.ToString("dd/MM/yyyy hh:mm:ss tt") : "Not Accepted")</td>
					<td>@(invitation.DeclinedDate.HasValue ? invitation.DeclinedDate.Value.ToString("dd/MM/yyyy hh:mm:ss tt") : "Not Declined")</td>
					<td class="text-center">
						@if (invitation.Status == "Pending")
						{
							<form asp-controller="ProjectInvitation" asp-action="Edit" method="post" class="d-inline" onsubmit="return confirmAction('accept');">
								<input type="hidden" name="Id" value="@invitation.Id" />
								<input type="hidden" name="Status" value="Accepted" />
								<button type="submit" class="btn btn-success btn-sm">Accept</button>
							</form>

							<form asp-controller="ProjectInvitation" asp-action="Edit" method="post" class="d-inline" onsubmit="return confirmAction('decline');">
								<input type="hidden" name="Id" value="@invitation.Id" />
								<input type="hidden" name="Status" value="Declined" />
								<button type="submit" class="btn btn-danger btn-sm">Decline</button>
							</form>
						}
					</td>
				</tr>
			}
		}
		else
		{
			<tr >
				<td colspan="100" class="text-center">You have no invitations at the moment.</td>
			</tr>
		}
		</tbody>
	</table>
</div>

							
<script type="text/javascript">
	function confirmAction(action) {
		var message = '';
		if (action === 'accept') {
			message = 'Are you sure you want to accept this invitation?';
		} else if (action === 'decline') {
			message = 'Are you sure you want to decline this invitation?';
		}

		return confirm(message);
	}
</script>